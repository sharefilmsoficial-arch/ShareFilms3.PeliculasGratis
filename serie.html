<script>
const SERIES = [
  {
    id: "whatif1",
    title: "What If...? Temporada 1",
    year: 2021,
    image: "series/What-If-TP1.WEBP",
    episodes: [
      { id: "ep1", n: 1, name: "¿Qué pasaría si el Capitán Carter fuera el primer vengador?", thumb: "series/whatif1/ep1.webp", drive: "https://drive.google.com/file/d/1X1X1X/view" },
      { id: "ep2", n: 2, name: "¿Qué pasaría si T’Challa se convirtiera en Star-Lord?", thumb: "series/whatif1/ep2.webp", drive: "https://drive.google.com/file/d/2X2X2X/view" },
      { id: "ep3", n: 3, name: "Los Vengadores caen", thumb: "series/whatif1/ep3.webp", drive: "https://drive.google.com/file/d/3X3X3X/view" },
      { id: "ep4", n: 4, name: "Doctor Strange pierde su corazón", thumb: "series/whatif1/ep4.webp", drive: "https://drive.google.com/file/d/4X4X4X/view" }
    ]
  },
  {
    id: "sevenscissors3",
    title: "Seven Scissors Temporada 3",
    year: 2024,
    image: "https://static1.cbrimages.com/wordpress/wp-content/uploads/2023/07/seven-deadly-sins-4.jpg",
    episodes: [
      { id: "ep1", n: 1, name: "Renacimiento", thumb: "series/seven/ep1.webp", drive: "https://drive.google.com/file/d/7A1/view" },
      { id: "ep2", n: 2, name: "Lazos rotos", thumb: "series/seven/ep2.webp", drive: "https://drive.google.com/file/d/7A2/view" },
      { id: "ep3", n: 3, name: "Pecados vs Ángeles", thumb: "series/seven/ep3.webp", drive: "https://drive.google.com/file/d/7A3/view" }
    ]
  }
];

const params = new URLSearchParams(location.search);
const serieId = params.get('id');
const epParam = params.get('ep'); // nuevo parámetro para episodio
const serie = SERIES.find(s => s.id === serieId);

if (!serie) {
  document.body.innerHTML = '<p style="padding:40px">Serie no encontrada. <a href="series.html">Volver</a></p>';
  throw new Error("Serie no encontrada");
}

// si hay ep en la URL, selecciona ese episodio, si no, el primero
let currentEp = epParam ? serie.episodes.find(e => e.n == epParam) : serie.episodes[0];

// render principal
function renderHero(ep) {
  const hero = document.getElementById('serieHero');
  hero.style.backgroundImage = `url(${serie.image})`;
  document.getElementById('serieInfo').innerHTML = `
    <h1>${serie.title}</h1>
    <p>${serie.year} • Episodio ${ep.n}: ${ep.name}</p>
    <button class="play-btn" onclick="window.open('${ep.drive}', '_blank')">▶ Reproducir</button>
  `;
}

function renderList() {
  const list = document.getElementById('episodesList');
  list.innerHTML = '<h2>Episodios</h2>' +
    serie.episodes.map(ep => `
      <div class="episode-card ${ep.n === currentEp.n ? 'active' : ''}" onclick="selectEpisode(${ep.n})">
        <img src="${ep.thumb}" alt="Ep ${ep.n}">
        <span><strong>E${ep.n}:</strong> ${ep.name}</span>
      </div>
    `).join('');
}

function selectEpisode(num) {
  currentEp = serie.episodes.find(e => e.n === num);
  history.replaceState(null, '', `?id=${serie.id}&ep=${num}`); // actualiza la URL sin recargar
  renderHero(currentEp);
  renderList();
}

// inicializar
renderHero(currentEp);
renderList();
</script>
